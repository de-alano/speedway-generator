<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Generator Programu Żużlowego</title>
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:200,400" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <header class="header">
            <h1 class="header__text">Generator Programu Żużlowego</h1>
        </header>

        <section class="generator">
            <h2 class="generator__title">Uzupełnij poniższe pola i wygeneruj gotowy program</h2>


            <div class="teams">
                <div class="team">
                    <div class="team__info team__hosts">
                        <h3 class="team__name">Gospodarze</h3>
                        <input type="text" class="team__input" placeholder="Nazwa drużyny" id="hosts">
                    </div>

                    <div class="team__riders">

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="9" placeholder="Zawodnik z numerem 9"
                                required>
                            <label for="9" class="team__rider__label">Zawodnik z numerem 9</label>
                        </div>


                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="10" placeholder="Zawodnik z numerem 10"
                                required>
                            <label for="10" class="team__rider__label">Zawodnik z numerem 10</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="11" placeholder="Zawodnik z numerem 11"
                                required>
                            <label for="11" class="team__rider__label">Zawodnik z numerem 11</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="12" placeholder="Zawodnik z numerem 12"
                                required>
                            <label for="12" class="team__rider__label">Zawodnik z numerem 12</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="13" placeholder="Zawodnik z numerem 13"
                                required>
                            <label for="13" class="team__rider__label">Zawodnik z numerem 13</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="14" placeholder="Zawodnik z numerem 14"
                                required>
                            <label for="14" class="team__rider__label">Zawodnik z numerem 14</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="15" placeholder="Zawodnik z numerem 15"
                                required>
                            <label for="15" class="team__rider__label">Zawodnik z numerem 15</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="16" placeholder="Zawodnik z numerem 16"
                                required>
                            <label for="16" class="team__rider__label">Zawodnik z numerem 16</label>
                        </div>

                    </div>

                </div>


                <div class="team">
                    <div class="team__info team__guests">
                        <h3 class="team__name">Goście</h3>
                        <input type="text" class="team__input" placeholder="Nazwa drużyny" id="guests" required>
                    </div>

                    <div class="team__riders">

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="1" placeholder="Zawodnik z numerem 1"
                                required>
                            <label for="1" class="team__rider__label">Zawodnik z numerem 1</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="2" placeholder="Zawodnik z numerem 2"
                                required>
                            <label for="2" class="team__rider__label">Zawodnik z numerem 2</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="3" placeholder="Zawodnik z numerem 3"
                                required>
                            <label for="3" class="team__rider__label">Zawodnik z numerem 3</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="4" placeholder="Zawodnik z numerem 4"
                                required>
                            <label for="4" class="team__rider__label">Zawodnik z numerem 4</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="5" placeholder="Zawodnik z numerem 5"
                                required>
                            <label for="5" class="team__rider__label">Zawodnik z numerem 5</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="6" placeholder="Zawodnik z numerem 6"
                                required>
                            <label for="6" class="team__rider__label">Zawodnik z numerem 6</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="7" placeholder="Zawodnik z numerem 7"
                                required>
                            <label for="7" class="team__rider__label">Zawodnik z numerem 7</label>
                        </div>

                        <div class="team__rider">
                            <input type="text" class="team__rider__input" id="8" placeholder="Zawodnik z numerem 8"
                                required>
                            <label for="8" class="team__rider__label">Zawodnik z numerem 8</label>
                        </div>

                    </div>

                </div>
            </div>

            <button class="generator__btn">Pobierz program</button>

            <script src="js/xlsx-populate.min.js"></script>
            <script>
                // Get inputs
                const hosts = document.getElementById('hosts');
                const guests = document.getElementById('guests');
                const allRiders = [...document.querySelectorAll('.team__rider > .team__rider__input')];

                var Promise = XlsxPopulate.Promise;
                var button = document.querySelector('button');

                function getWorkbook() {
                    return new Promise(function (resolve, reject) {
                        var req = new XMLHttpRequest();
                        var url = './ekstraliga.xlsx';
                        req.open("GET", url, true);
                        req.responseType = "arraybuffer";
                        req.onreadystatechange = function () {
                            if (req.readyState === 4) {
                                if (req.status === 200) {
                                    resolve(XlsxPopulate.fromDataAsync(req.response))
                                } else {
                                    reject('Received a ' + req.status + ' HTTP code.')
                                }
                            }
                        }

                        req.send();
                    })
                }

                function generate(type) {
                    return getWorkbook()
                        .then(function (workbook) {
                            workbook.sheet(0).cell('C2').value(hosts.value);
                            workbook.sheet(0).cell('C5').value(allRiders[0].value);
                            workbook.sheet(0).cell('C6').value(allRiders[1].value);
                            workbook.sheet(0).cell('C7').value(allRiders[2].value);
                            workbook.sheet(0).cell('C8').value(allRiders[3].value);
                            workbook.sheet(0).cell('C9').value(allRiders[4].value);
                            workbook.sheet(0).cell('C10').value(allRiders[5].value);
                            workbook.sheet(0).cell('C11').value(allRiders[6].value);

                            workbook.sheet(0).cell('U2').value(guests.value);
                            workbook.sheet(0).cell('U5').value(allRiders[8].value);
                            workbook.sheet(0).cell('U6').value(allRiders[9].value);
                            workbook.sheet(0).cell('U7').value(allRiders[10].value);
                            workbook.sheet(0).cell('U8').value(allRiders[11].value);
                            workbook.sheet(0).cell('U9').value(allRiders[12].value);
                            workbook.sheet(0).cell('U10').value(allRiders[13].value);
                            workbook.sheet(0).cell('U11').value(allRiders[14].value);
                            return workbook.outputAsync({ type: type })
                        });
                }

                function generateBlob() {
                    return generate()
                        .then(function (blob) {
                            var url = window.URL.createObjectURL(blob);
                            var a = document.createElement('a');
                            document.body.appendChild(a);
                            a.href = url;
                            a.download = 'Program Żużlowy.xlsx';
                            a.click();
                            window.URL.revokeObjectURL(url);
                            document.body.removeChild(a);
                        })
                }

                document.querySelector('.generator__btn').addEventListener('click', generateBlob);

            </script>

        </section>

        <footer class="legal">&copy; 2019 by <span class="author">Alan Dominiczak</span>. Wszystkie prawa zastrzeżone.
        </footer>
    </div>
</body>

</html>